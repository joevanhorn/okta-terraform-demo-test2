{
  "description": "Risk rules (Separation of Duties policies) for Okta tenant",
  "last_synced": null,
  "version": "1.0",
  "rules": [
  ],
  "notes": [
    "This file manages risk rules (SOD policies) for Access Certifications and Access Requests",
    "Risk rules define criteria for granted principal access that are a risk to your org",
    "",
    "HOW TO ADD A RISK RULE:",
    "1. Copy the example below into the 'rules' array above",
    "2. Update the name, description, and resourceOrn for your app",
    "3. Update the entitlement set IDs and entitlement value IDs",
    "4. Submit a PR with your changes",
    "5. Run: gh workflow run apply-risk-rules.yml -f environment=myorg -f dry_run=false",
    "",
    "HOW TO FIND ENTITLEMENT IDs:",
    "- Use: gh workflow run find-entitlement-value.yml -f environment=myorg -f search_term='Role Name'",
    "- Or run: python3 scripts/import_oig_resources.py --output-dir environments/myorg",
    "- Entitlement set ID: Look in terraform/oig_entitlements.tf for okta_entitlement_bundle resources",
    "- Entitlement value ID: Check the terraform state or use find-entitlement-value workflow",
    "",
    "EXAMPLE RISK RULE (copy this into 'rules' array above):",
    "{",
    "  \"name\": \"Change Management Conflict\",",
    "  \"description\": \"Users who approve changes should not be the same as individuals who implement changes\",",
    "  \"notes\": \"Prevents SOD violation in ServiceNow change management process\",",
    "  \"type\": \"SEPARATION_OF_DUTIES\",",
    "  \"resources\": [",
    "    {",
    "      \"resourceOrn\": \"orn:okta:idp:00omx5xxhePEbjFNp1d7:apps:servicenow_ud:0oar0edy8iuBrRn6t1d7\"",
    "    }",
    "  ],",
    "  \"conflictCriteria\": {",
    "    \"and\": [",
    "      {",
    "        \"name\": \"List 1 - Change Implementers\",",
    "        \"attribute\": \"principal.effective_grants\",",
    "        \"operation\": \"CONTAINS_ALL\",",
    "        \"value\": {",
    "          \"type\": \"ENTITLEMENTS\",",
    "          \"value\": [",
    "            {",
    "              \"id\": \"esp12pvbc9GsRkvu31d7\",",
    "              \"values\": [",
    "                {",
    "                  \"id\": \"ent12pve87e6OIyjW1d7\"",
    "                },",
    "                {",
    "                  \"id\": \"ent12pvecwH0jSS211d7\"",
    "                }",
    "              ]",
    "            }",
    "          ]",
    "        }",
    "      },",
    "      {",
    "        \"name\": \"List 2 - Change Approvers\",",
    "        \"attribute\": \"principal.effective_grants\",",
    "        \"operation\": \"CONTAINS_ONE\",",
    "        \"value\": {",
    "          \"type\": \"ENTITLEMENTS\",",
    "          \"value\": [",
    "            {",
    "              \"id\": \"esp12pvbc9GsRkvu31d7\",",
    "              \"values\": [",
    "                {",
    "                  \"id\": \"ent12pve249pIX0AC1d7\"",
    "                }",
    "              ]",
    "            }",
    "          ]",
    "        }",
    "      }",
    "    ]",
    "  }",
    "}",
    "",
    "FIELD EXPLANATIONS:",
    "- name: Display name for the risk rule",
    "- description: Explains what SOD conflict this rule prevents",
    "- notes: (Optional) Additional context about this policy",
    "- type: Always 'SEPARATION_OF_DUTIES' (only type currently supported)",
    "- resources: Array with ONE resource (app/collection/bundle) - max 1 allowed",
    "- resourceOrn: Full ORN of the resource (app, collection, or bundle)",
    "- conflictCriteria.and: Array of 2+ conditions that ALL must be true for conflict",
    "- attribute: Always 'principal.effective_grants' (checks user's entitlements)",
    "- operation: CONTAINS_ONE (any of) or CONTAINS_ALL (all of)",
    "- value.type: Always 'ENTITLEMENTS'",
    "- value.value: Array of entitlement sets with their values",
    "",
    "OPERATIONS:",
    "- CONTAINS_ONE: Principal has at least ONE of the specified entitlements",
    "- CONTAINS_ALL: Principal has ALL of the specified entitlements",
    "",
    "CONFLICT LOGIC:",
    "The 'and' array defines conditions that create a conflict when ALL are true:",
    "- Example above: User has ALL implementer roles AND has ANY approver role = CONFLICT",
    "- You can have 2+ conditions in the 'and' array",
    "- Each condition checks for presence of specific entitlements",
    "",
    "WORKFLOW COMMANDS:",
    "- Import from Okta: gh workflow run import-risk-rules.yml -f environment=myorg -f commit_changes=true",
    "- Apply to Okta (dry-run): gh workflow run apply-risk-rules.yml -f environment=myorg -f dry_run=true",
    "- Apply to Okta (live): gh workflow run apply-risk-rules.yml -f environment=myorg -f dry_run=false",
    "- Apply with delete: gh workflow run apply-risk-rules.yml -f environment=myorg -f dry_run=false -f delete_removed=true",
    "",
    "API SCOPES REQUIRED:",
    "- okta.governance.riskRule.read (for import)",
    "- okta.governance.riskRule.manage (for apply/delete)"
  ]
}
